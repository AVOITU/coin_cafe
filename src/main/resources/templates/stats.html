<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Stats – Coin Café</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">
    <!-- AdminLTE -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
    <style>
        .chart-box{ height: 320px; }
        .chart-sm{ height: 260px; }
        .brand-text{ font-weight:600; }
    </style>
</head>
<body class="hold-transition layout-top-nav">
<div class="wrapper">
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <div class="container">
            <a class="navbar-brand" href="#">
                <span class="brand-text">Ravy – Statistiques du sondage</span>
            </a>
        </div>
    </nav>

    <!-- Content Wrapper -->
    <div class="content-wrapper">
        <div class="content-header">
            <div class="container">
                <div class="row mb-2">
                    <div class="col-12">
                        <h1 class="m-0">Tableau de bord</h1>
                        <p class="text-muted mb-0" id="exp">Phrase explicative : synthèse des réponses du sondage.</p>
                    </div>
                </div>
            </div>
        </div>

        <section class="content">
            <div class="container">
                <div class="row">
                    <!-- Gauge note globale -->
                    <div class="col-md-4">
                        <div class="card card-info">
                            <div class="card-header"><h3 class="card-title">Note globale</h3></div>
                            <div class="card-body d-flex align-items-center justify-content-center">
                                <canvas id="gaugeChart" class="chart-sm"></canvas>
                            </div>
                            <div class="card-footer text-center">
                                <span id="globalRatingText" class="h5 mb-0"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Pie: répartition des notes -->
                    <div class="col-md-4">
                        <div class="card card-primary">
                            <div class="card-header"><h3 class="card-title">Répartition des notes</h3></div>
                            <div class="card-body"><canvas id="pieChart" class="chart-box"></canvas></div>
                            <div class="card-footer text-muted">1 à 5 sur l'ensemble des réponses.</div>
                        </div>
                    </div>

                    <!-- Line: progression dans le temps -->
                    <div class="col-md-4">
                        <div class="card card-success">
                            <div class="card-header"><h3 class="card-title">Évolution temporelle</h3></div>
                            <div class="card-body"><canvas id="lineChart" class="chart-box"></canvas></div>
                            <div class="card-footer text-muted">Moyenne globale par période.</div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Bar: moyenne par catégorie -->
                    <div class="col-md-6">
                        <div class="card card-warning">
                            <div class="card-header"><h3 class="card-title">Moyenne par catégorie</h3></div>
                            <div class="card-body"><canvas id="barCatChart" class="chart-box"></canvas></div>
                        </div>
                    </div>

                    <!-- HBar: moyenne par question -->
                    <div class="col-md-6">
                        <div class="card card-secondary">
                            <div class="card-header"><h3 class="card-title">Moyenne par question</h3></div>
                            <div class="card-body"><canvas id="barQuestionChart" class="chart-box"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer class="main-footer text-sm">
        <div class="container">
            <strong>&copy; <span id="year"></span> Ravy.</strong>
            <span class="float-right d-none d-sm-inline">AdminLTE 3 · Chart.js</span>
        </div>
    </footer>
</div>

<!-- jQuery / Bootstrap / AdminLTE -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
<!-- Chart.js v4 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
    // --------- Données d'exemple (REMPLACER par vos vraies données) ---------
    const survey = {
        globalRating: 3.8,  // sur 5
        pieCounts: { 1: 8, 2: 12, 3: 22, 4: 28, 5: 30 },
        timeline: {
            labels: ["Semaine 1","Semaine 2","Semaine 3","Semaine 4","Semaine 5"],
            values:  [19, 27, 23, 31, 34].map(v=> (v/10)) // converti sur échelle 0..5
        },
        categories: {
            labels: ["Hygiène","Accueil","Ambiance","Accessibilité","Signalétique","Service","Produits","Qualité/Prix","Diversité","Wi‑Fi"],
            values: [3.9,4.2,3.7,3.8,3.4,4.1,3.6,3.8,3.2,3.5]
        },
        byQuestion: {
            labels: ["Q1","Q2","Q3","Q4","Q5","Q6","Q7","Q8","Q9","Q10"],
            values: [3.9,4.2,3.7,3.8,3.4,4.1,3.6,3.8,3.2,3.5]
        }
    };
    // -----------------------------------------------------------------------

    document.getElementById('year').textContent = new Date().getFullYear();
    document.getElementById('globalRatingText').textContent = survey.globalRating.toFixed(1) + ' / 5';

    // Palette neutre (Chart.js générera des couleurs par défaut si vide)
    const mkTicks = (max=5)=>({ beginAtZero:true, suggestedMax:max, stepSize:1 });

    // ---- Gauge (Doughnut avec valeur et reste) ----
    const gauge = new Chart(document.getElementById('gaugeChart'), {
        type: 'doughnut',
        data: {
            labels: ['Note','Reste'],
            datasets: [{ data: [survey.globalRating, 5 - survey.globalRating] }]
        },
        options: {
            responsive: true,
            cutout: '70%',
            plugins: { legend: { display: false } },
            rotation: -90,
            circumference: 180
        }
    });

    // ---- Pie répartition des notes ----
    const pieLabels = Object.keys(survey.pieCounts).map(k=>`Note ${k}`);
    const pieValues = Object.values(survey.pieCounts);
    new Chart(document.getElementById('pieChart'), {
        type: 'pie',
        data: { labels: pieLabels, datasets: [{ data: pieValues }]},
        options: { responsive: true }
    });

    // ---- Courbe temporelle ----
    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: { labels: survey.timeline.labels, datasets: [{ label: 'Moyenne', data: survey.timeline.values, tension: .3, fill: false }]},
        options: { scales: { y: { ...mkTicks(5) } } }
    });

    // ---- Bar: moyenne par catégorie (vertical) ----
    new Chart(document.getElementById('barCatChart'), {
        type: 'bar',
        data: { labels: survey.categories.labels, datasets: [{ label: 'Moyenne', data: survey.categories.values }]},
        options: { scales: { y: { ...mkTicks(5) } }, plugins:{ legend:{ display:false } } }
    });

    // ---- Bar horizontale moyenne par question ----
    new Chart(document.getElementById('barQuestionChart'), {
        type: 'bar',
        data: { labels: survey.byQuestion.labels, datasets: [{ label: 'Moyenne', data: survey.byQuestion.values }]},
        options: { indexAxis: 'y', scales: { x: { ...mkTicks(5) } }, plugins:{ legend:{ display:false } } }
    });
</script>
</body>
</html>